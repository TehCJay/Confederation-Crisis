# this selects a random province of a realm, then generate a character that is adult and came from there
# intention is for example generate senators, representing a specific province.
generate_random_lowborn_adult_from_realm_effect = {
    random_realm_province = {
        generate_random_lowborn_adult_from_province_effect = yes
    }
}

generate_random_highborn_adult_from_realm_effect = {
    random_realm_province = {
        generate_random_highborn_adult_from_province_effect = yes
    }
}

generate_random_soldier_adult_from_realm_effect = {
    random_realm_province = {
        generate_random_soldier_adult_from_province_effect = yes
    }
}

generate_random_soldier_adult_from_province_effect = {
    hidden_tooltip = {
        create_random_soldier = {
            age = 27
            random_traits = yes
            religion = THIS
            culture = THIS
            employer = PREV
            dynasty = actually_culture
            female = 20
        }
        roll1d60 = yes
        new_character = {
            add_age = dice1d60
        }
        random = {
            chance = 1
            new_character = {
                add_trait = ambitious
                remove_trait = imbecile
                remove_trait = slow
                remove_trait = quick
                add_trait = genius
                remove_trait = fair
                remove_trait = homely
                remove_trait = ugly
                add_trait = beautiful
                remove_trait = dwarf
                add_trait = tall
                change_diplomacy = 5
                change_learning = 3
                change_martial = 3
                change_stewardship = 1
            }
        }
    }
    custom_tooltip = { text = generate_lowborn_senator_tooltip }
}

generate_random_lowborn_adult_from_province_effect = {
    hidden_tooltip = {
        create_character = {
            age = 27
            random_traits = yes
            religion = THIS
            culture = THIS
            employer = PREV
            dynasty = none
            female = 60
        }
        roll1d60 = yes
        new_character = {
            add_age = dice1d60
        }
        random = {
            chance = 1
            new_character = {
                add_trait = ambitious
                remove_trait = imbecile
                remove_trait = slow
                remove_trait = quick
                add_trait = genius
                remove_trait = fair
                remove_trait = homely
                remove_trait = ugly
                add_trait = beautiful
                remove_trait = dwarf
                add_trait = tall
                change_diplomacy = 5
                change_learning = 3
                change_intrigue = 3
                change_stewardship = 1
            }
        }
    }
    custom_tooltip = { text = generate_lowborn_senator_tooltip }
}

generate_random_highborn_adult_from_province_effect = {
    hidden_tooltip = {
        create_character = {
            age = 27
            random_traits = yes
            religion = THIS
            culture = THIS
            employer = PREV
            dynasty = actually_culture
            female = 60
        }
        roll1d60 = yes
        new_character = {
            add_age = dice1d60
        }
        random = {
            chance = 1
            new_character = {
                add_trait = ambitious
                remove_trait = imbecile
                remove_trait = slow
                remove_trait = quick
                add_trait = genius
                remove_trait = fair
                remove_trait = homely
                remove_trait = ugly
                add_trait = beautiful
                remove_trait = dwarf
                add_trait = tall
                change_diplomacy = 5
                change_learning = 3
                change_intrigue = 3
                change_stewardship = 1
            }
        }
    }
    custom_tooltip = { text = generate_highborn_senator_tooltip }
}

count_senator_seats_to_fill = {
    hidden_tooltip = {
        ROOT = {
            set_variable = { which = empty_seats value = 0 }
            if = { limit = { can_grant_title = title_senatorduke }
                change_variable = { which = empty_seats value = 5 }
                any_courtier_or_vassal = {
                    limit = { has_minor_title = title_senatorduke }
                    PREV = {
                        subtract_variable = { which = empty_seats value = 1 }
                        change_variable = { which = title_senatorduke_granted value = 1 }
                    }
                }
            }
            if = { limit = { can_grant_title = title_senatorking }
                change_variable = { which = empty_seats value = 5 }
                any_courtier_or_vassal = {
                    limit = { has_minor_title = title_senatorking }
                    PREV = {
                        subtract_variable = { which = empty_seats value = 1 }
                        change_variable = { which = title_senatorking_granted value = 1 }
                    }
                }
            }
            if = { limit = { can_grant_title = title_senatoremperor }
                change_variable = { which = empty_seats value = 10 }
                any_courtier_or_vassal = {
                    limit = { has_minor_title = title_senatoremperor }
                    PREV = {
                        subtract_variable = { which = empty_seats value = 1 }
                        change_variable = { which = title_senatoremperor_granted value = 1 }
                    }
                }
            }
            if = { limit = { can_grant_title = title_senatorbigrealm1 }
                change_variable = { which = empty_seats value = 5 }
                any_courtier_or_vassal = {
                    limit = { has_minor_title = title_senatorbigrealm1 }
                    PREV = {
                        subtract_variable = { which = empty_seats value = 1 }
                        change_variable = { which = title_senatorbigrealm1_granted value = 1 }
                    }
                }
            }
            if = { limit = { can_grant_title = title_senatorbigrealm2 }
                change_variable = { which = empty_seats value = 5 }
                any_courtier_or_vassal = {
                    limit = { has_minor_title = title_senatorbigrealm2 }
                    PREV = {
                        subtract_variable = { which = empty_seats value = 1 }
                        change_variable = { which = title_senatorbigrealm2_granted value = 1 }
                    }
                }
            }
            if = { limit = { can_grant_title = title_senatorbigrealm3 }
                change_variable = { which = empty_seats value = 5 }
                any_courtier_or_vassal = {
                    limit = { has_minor_title = title_senatorbigrealm3 }
                    PREV = {
                        subtract_variable = { which = empty_seats value = 1 }
                        change_variable = { which = title_senatorbigrealm3_granted value = 1 }
                    }
                }
            }
            if = { limit = { can_grant_title = title_senatorbigrealm4 }
                change_variable = { which = empty_seats value = 10 }
                any_courtier_or_vassal = {
                    limit = { has_minor_title = title_senatorbigrealm4 }
                    PREV = {
                        subtract_variable = { which = empty_seats value = 1 }
                        change_variable = { which = title_senatorbigrealm4_granted value = 1 }
                    }
                }
            }
            if = { limit = { can_grant_title = title_senatorbigrealm5 }
                change_variable = { which = empty_seats value = 25 }
                any_courtier_or_vassal = {
                    limit = { has_minor_title = title_senatorbigrealm5 }
                    PREV = {
                        subtract_variable = { which = empty_seats value = 1 }
                        change_variable = { which = title_senatorbigrealm5_granted value = 1 }
                    }
                }
            }
        }
    }
}

fill_seats_with_courtiers = {
    any_courtier_or_vassal = {
        if = {
            limit = { is_voter = no }
            if = { limit = { can_hold_title = title_senatorduke
            PREV = { can_grant_title = title_senatorduke }}
                give_minor_title = title_senatorduke }
            else_if = { limit = { can_hold_title = title_senatorking
            PREV = { can_grant_title = title_senatorking }}
                give_minor_title = title_senatorking }
            else_if = { limit = { can_hold_title = title_senatoremperor
            PREV = { can_grant_title = title_senatoremperor }}
                give_minor_title = title_senatoremperor }
            else_if = { limit = { can_hold_title = title_senatorbigrealm1
            PREV = { can_grant_title = title_senatorbigrealm1 }}
                give_minor_title = title_senatorbigrealm1 }
            else_if = { limit = { can_hold_title = title_senatorbigrealm2
            PREV = { can_grant_title = title_senatorbigrealm2 }}
                give_minor_title = title_senatorbigrealm2 }
            else_if = { limit = { can_hold_title = title_senatorbigrealm3
            PREV = { can_grant_title = title_senatorbigrealm3 }}
                give_minor_title = title_senatorbigrealm3 }
            else_if = { limit = { can_hold_title = title_senatorbigrealm4
            PREV = { can_grant_title = title_senatorbigrealm4 }}
                give_minor_title = title_senatorbigrealm4 }
            else_if = { limit = { can_hold_title = title_senatorbigrealm5
            PREV = { can_grant_title = title_senatorbigrealm5 }}
                give_minor_title = title_senatorbigrealm5 }
        }
    }
}

fill_seats_with_realm_characters = {
    any_realm_character = {
        if = {
            limit = { is_voter = no is_ruler = no is_immune_to_pruning = no
                NOT = { has_minor_title = title_commander has_minor_title = title_court_physician } }
            if = { limit = { can_hold_title = title_senatorduke
            PREV = { can_grant_title = title_senatorduke }}
                move_character = PREV give_minor_title = title_senatorduke }
            else_if = { limit = { can_hold_title = title_senatorking
            PREV = { can_grant_title = title_senatorking }}
                move_character = PREV give_minor_title = title_senatorking }
            else_if = { limit = { can_hold_title = title_senatoremperor
            PREV = { can_grant_title = title_senatoremperor }}
                move_character = PREV give_minor_title = title_senatoremperor }
            else_if = { limit = { can_hold_title = title_senatorbigrealm1
            PREV = { can_grant_title = title_senatorbigrealm1 }}
                move_character = PREV give_minor_title = title_senatorbigrealm1 }
            else_if = { limit = { can_hold_title = title_senatorbigrealm2
            PREV = { can_grant_title = title_senatorbigrealm2 }}
                move_character = PREV give_minor_title = title_senatorbigrealm2 }
            else_if = { limit = { can_hold_title = title_senatorbigrealm3
            PREV = { can_grant_title = title_senatorbigrealm3 }}
                move_character = PREV give_minor_title = title_senatorbigrealm3 }
            else_if = { limit = { can_hold_title = title_senatorbigrealm4
            PREV = { can_grant_title = title_senatorbigrealm4 }}
                move_character = PREV give_minor_title = title_senatorbigrealm4 }
            else_if = { limit = { can_hold_title = title_senatorbigrealm5
            PREV = { can_grant_title = title_senatorbigrealm5 }}
                move_character = PREV give_minor_title = title_senatorbigrealm5 }
        }
    }
}

#fire_extra_senators_effect = {
#    if = {
#        limit = {
#            has_assigned_minor_title = {
#                title = title_senatorduke
#                count > 5
#            }
#        }
#        random_courtier = {
#            limit = { has_title = title_senatorduke }
#        }
#    }
#}

fire_all_senators_effect = {
    any_courtier_or_vassal = {
        remove_title = title_senatorduke
        remove_title = title_senatorking
        remove_title = title_senatoremperor
        remove_title = title_senatorbigrealm1
        remove_title = title_senatorbigrealm2
        remove_title = title_senatorbigrealm3
        remove_title = title_senatorbigrealm4
        remove_title = title_senatorbigrealm5
    }
}

#scope of this, is expected to be a ruler character
replace_senators_effect = {
    if = {
        limit = {
            is_alive = yes # somehow we were replacing senators of dead people, resulting in thousands of senators...
            NOT = { has_law = legislative_type_autocratic } # voter appointment law, letting liege to appoint whenever he wants
            OR = {
                free_court_slots > 10
                NOT = { has_character_flag = processing_senate }
                had_character_flag = { flag = processing_senate days = 30 }
            }
        }

        set_character_flag = processing_senate
        log = "Processing senate for [This.GetBestName]"

        fill_seats_with_courtiers = yes
        fill_seats_with_realm_characters = yes

        if = {
            limit = {
                OR = {
                    can_grant_title = title_senatorduke
                    can_grant_title = title_senatorking
                    can_grant_title = title_senatoremperor
                    can_grant_title = title_senatorbigrealm1
                    can_grant_title = title_senatorbigrealm2
                    can_grant_title = title_senatorbigrealm3
                    can_grant_title = title_senatorbigrealm4
                    can_grant_title = title_senatorbigrealm5
                }
            }

            count_senator_seats_to_fill = yes

            log = "Generating characters for [This.empty_seats.GetValue] seats"

            while = {
                limit = { check_variable = { which = empty_seats value > 0 } }
                if = {
                    limit = { has_law = legislative_type_aristocratic }
                    generate_random_highborn_adult_from_realm_effect = yes
                }
                else_if = {
                    limit = { has_law = legislative_type_democratic }
                    random_list = {
                        10 = { generate_random_highborn_adult_from_realm_effect = yes }
                        10 = { generate_random_lowborn_adult_from_realm_effect = yes }
                    }
                }
                else_if =  {
                    limit = { has_law = legislative_type_stratocratic }
                    generate_random_soldier_adult_from_realm_effect = yes
                }
                else = {
                    generate_random_lowborn_adult_from_realm_effect = yes
                }
                subtract_variable = { which = empty_seats value = 1 }
            }

            fill_seats_with_courtiers = yes
            fill_seats_with_realm_characters = yes

            if = {
                limit = { free_court_slots < -30 }
                log = "Minus 30 free court slots for character [This.GetBestName]"
            }
            else = {
                character_event = { id = parliaments.001 days = 1 } # Stop generating characters to avoid bankrupticing the dynasty forever with all the hotel bills...
            }

            # We call the event to fill seats again just to be sure nothing went wrong, it should do nothing if seats are already full, it must be with a delay to avoid infinite loops.
            clr_character_flag = processing_senate
        }
    }
}



# From Vanilla but heavily edited

spawn_good_commander_effect = {
    random_list = {
        50 = {
            create_random_soldier = {
                random_traits = yes
                culture = ROOT
                religion = ROOT
                female = yes
                dynasty = actually_culture
                attributes = {
                    diplomacy = 2
                    learning = 2
                    stewardship = 2
                    intrigue = 2
                    martial = 8
                }
            }
        }
        50 = {
            create_random_soldier = {
                random_traits = yes
                culture = ROOT
                religion = ROOT
                female = no
                dynasty = actually_culture
                attributes = {
                    diplomacy = 2
                    learning = 2
                    stewardship = 2
                    intrigue = 2
                    martial = 8
                }
            }
        }
    }
    new_character = {
        add_age = 4 # Guarantee they're at least 20, 18 to be adult, 20 to complete military training
        remove_trait = weak
        remove_trait = slow
        remove_trait = imbecile
        remove_trait = dull

        remove_trait = mystic
        remove_trait = socializer
        remove_trait = gamer
        remove_trait = hedonist
        remove_trait = duelist
        remove_trait = hunter
        remove_trait = strategist
        remove_trait = administrator
        remove_trait = architect
        remove_trait = gardener
        remove_trait = schemer
        remove_trait = impaler
        remove_trait = seducer
        remove_trait = seductress
        remove_trait = theologian
        remove_trait = intellectual

        random_list = {
            25 = { add_trait = warship_captain }
            25 = { add_trait = marine_captain }
            25 = { add_trait = frigate_pilot }
            25 = { add_trait = army_captain }
        }

        random_list = { # Flavor Randomization
            35 = {
                # Nothing
            }
            15 = {
                change_martial = 2
            }
            10 = {
                add_trait = strong
            }
            10 = {
                add_trait = duelist
            }
            10 = {
                add_trait = hunter
            }
            5 = {
                add_trait = strategist
            }
            5 = {
                change_martial = 4
            }
            5 = {
                if = {
                    limit = {
                        has_dlc = "Reapers"
                    }
                    add_trait = one_eyed
                }
            }
            5 = {
                add_trait = shrewd
            }
            3 = {
                add_trait = giant
            }
        }
        # Cybernetics
        if = {
            limit = { NOT = { religion_group = religious_group } }
            random_list = {
                100 = { }
                25 = { add_trait = cybernetic_limb }
                25 = {
                    if = {
                        limit = { has_dlc = "Reapers" }
                        add_trait = cybernetic_leg
                    }
                    else = { add_trait = cybernetic_limb }
                }
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
            }
            random = {
                chance = 20
                add_trait = odin_mk_i
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 2 }
            }
            random = {
                chance = 20
                remove_trait = odin_mk_i
                add_trait = odin_mk_ii
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 4 }
            }
            random = {
                chance = 20
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                add_trait = odin_mk_iii
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 6 }
            }
            random = {
                chance = 20
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                remove_trait = odin_mk_iii
                add_trait = odin_mk_iv
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 8 }
            }
            random = {
                chance = 20
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                remove_trait = odin_mk_iii
                remove_trait = odin_mk_iv
                add_trait = odin_mk_v
            }
        }
        set_dynasty_flag = flag_valid_surname
        set_character_flag = invited_soldier
        save_event_target_as = invited_character
    }
}

spawn_great_commander_effect = {
    random_list = {
        50 = {
            create_random_soldier = {
                random_traits = yes
                culture = ROOT
                religion = ROOT
                female = yes
                dynasty = actually_culture
                attributes = {
                    diplomacy = 3
                    learning = 3
                    stewardship = 3
                    intrigue = 3
                    martial = 9
                }
            }
        }
        50 = {
            create_random_soldier = {
                random_traits = yes
                culture = ROOT
                religion = ROOT
                female = no
                dynasty = actually_culture
                attributes = {
                    diplomacy = 3
                    learning = 3
                    stewardship = 3
                    intrigue = 3
                    martial = 9
                }
            }
        }
    }
    new_character = {
        add_age = 5 # Guarantee they went through military training
        remove_trait = weak
        remove_trait = slow
        remove_trait = imbecile
        remove_trait = dull
        remove_trait = dwarf
        remove_trait = giant
        remove_trait = hunchback
        remove_trait = clubfooted
        remove_trait = craven

        remove_trait = mystic
        remove_trait = socializer
        remove_trait = gamer
        remove_trait = hedonist
        remove_trait = duelist
        remove_trait = hunter
        remove_trait = strategist
        remove_trait = administrator
        remove_trait = architect
        remove_trait = gardener
        remove_trait = schemer
        remove_trait = impaler
        remove_trait = seducer
        remove_trait = seductress
        remove_trait = theologian
        remove_trait = intellectual

        random_list = {
            25 = { add_trait = warship_captain }
            25 = { add_trait = marine_captain }
            25 = { add_trait = frigate_pilot }
            25 = { add_trait = army_captain }
        }

        remove_trait = misguided_warrior
        remove_trait = tough_soldier
        remove_trait = skilled_tactician
        remove_trait = brilliant_strategist

        random_list = {
            5 = { add_trait = misguided_warrior }
            10 = { add_trait = tough_soldier }
            20 = { add_trait = skilled_tactician }
            30 = { add_trait = brilliant_strategist }
        }

        random_list = { # Flavor Randomization
            35 = {
                # Nothing
            }
            15 = {
                change_martial = 2
            }
            10 = {
                add_trait = strong
            }
            10 = {
                add_trait = duelist
            }
            10 = {
                add_trait = hunter
            }
            5 = {
                add_trait = strategist
            }
            5 = {
                change_martial = 4
            }
            5 = {
                if = {
                    limit = {
                        has_dlc = "Reapers"
                    }
                    add_trait = one_eyed
                }
            }
            5 = {
                add_trait = shrewd
            }
            1 = {
                add_trait = giant
            }
        }
        random_list = {
            50 = {
                #Nothing
            }
            10 = {
                add_trait = narrow_flank_leader
            }
            10 = {
                add_trait = defensive_leader
            }
            10 = {
                add_trait = experimenter
            }
            10 = {
                add_trait = flanker
            }
            10 = {
                add_trait = heavy_infantry_leader
            }
            10 = {
                add_trait = inspiring_leader
            }
            10 = {
                add_trait = organizer
            }
            10 = {
                add_trait = siege_leader
            }
            10 = {
                add_trait = trickster
            }
            10 = {
                add_trait = aggressive_leader
            }
        }
        # Cybernetics
        if = {
            limit = { NOT = { religion_group = religious_group } }
            random_list = {
                100 = { }
                25 = { add_trait = cybernetic_limb }
                25 = {
                    if = {
                        limit = { has_dlc = "Reapers" }
                        add_trait = cybernetic_leg
                    }
                    else = { add_trait = cybernetic_limb }
                }
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
            }
            random = {
                chance = 20
                add_trait = odin_mk_i
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 2 }
            }
            random = {
                chance = 20
                remove_trait = odin_mk_i
                add_trait = odin_mk_ii
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 4 }
            }
            random = {
                chance = 20
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                add_trait = odin_mk_iii
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 6 }
            }
            random = {
                chance = 20
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                remove_trait = odin_mk_iii
                add_trait = odin_mk_iv
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 8 }
            }
            random = {
                chance = 20
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                remove_trait = odin_mk_iii
                remove_trait = odin_mk_iv
                add_trait = odin_mk_v
            }
        }
        # Biological Traits for specific cultures
        if = {
            limit = { culture = heavy_worlder_ge }
            random = {
                chance = 60
                remove_trait = spacer_physiology
                add_trait = heavy_worlder
            }
        }
        if = {
            limit = { culture = cat_splice_ge }
            random = {
                chance = 60
                add_trait = cat_splice
            }
        }
        if = {
            limit = { culture = organic_wifi_ge }
            random = {
                chance = 60
                add_trait = organic_wifi
            }
        }
        if = {
            limit = { culture = bio_ge }
            random = {
                chance = 35
                remove_trait = organic_wifi
                remove_trait = cat_splice
                remove_trait = spacer_physiology
                add_trait = heavy_worlder
            }
        }
        if = {
            limit = { culture = bio_ge }
            random = {
                chance = 25
                remove_trait = organic_wifi
                remove_trait = heavy_worlder
                remove_trait = spacer_physiology
                add_trait = cat_splice
            }
        }
        if = {
            limit = { culture = bio_ge }
            random = {
                chance = 35
                remove_trait = cat_splice
                remove_trait = heavy_worlder
                remove_trait = spacer_physiology
                add_trait = organic_wifi
            }
        }
        if = {
            limit = { culture = bio_ge }
            random = {
                chance = 5
                remove_trait = organic_wifi
                remove_trait = heavy_worlder
                remove_trait = cat_splice
                add_trait = spacer_physiology
            }
        }
        if = {
            limit = { any_liege = { trait = spacer_physiology } }
            random = {
                chance = 10
                remove_trait = heavy_worlder
                add_trait = spacer_physiology
            }
        }
        if = {
            limit = { religion = astrist }
            random = {
                chance = 25
                remove_trait = heavy_worlder
                add_trait = spacer_physiology
            }
        }
        if = {
            limit = {
                religion = astrist
                top_liege = { trait = spacer_physiology }
                }
            random = {
                chance = 25
                remove_trait = heavy_worlder
                add_trait = spacer_physiology
            }
        }
        if = {
            limit = { location = { province_id = 202 } }
            random = {
                chance = 66
                add_trait = born_in_the_purple
            }
        }
        set_dynasty_flag = flag_valid_surname
        set_character_flag = invited_soldier
        save_event_target_as = invited_character
    }
}

spawn_fantastic_commander_effect = {
    random_list = {
        50 = {
            create_random_soldier = {
                random_traits = yes
                culture = ROOT
                religion = ROOT
                female = yes
                dynasty = actually_culture
                attributes = {
                    diplomacy = 4
                    learning = 4
                    stewardship = 4
                    intrigue = 4
                    martial = 12
                }
            }
        }
        50 = {
            create_random_soldier = {
                random_traits = yes
                culture = ROOT
                religion = ROOT
                female = no
                dynasty = actually_culture
                attributes = {
                    diplomacy = 4
                    learning = 4
                    stewardship = 4
                    intrigue = 4
                    martial = 12
                }
            }
        }
    }
    new_character = {
        add_age = 8 # Guarantee they did a lot of military training
        remove_trait = weak
        remove_trait = slow
        remove_trait = imbecile
        remove_trait = dull
        remove_trait = dwarf
        remove_trait = giant
        remove_trait = hunchback
        remove_trait = clubfooted
        remove_trait = craven
        remove_trait = paranoid

        remove_trait = mystic
        remove_trait = socializer
        remove_trait = gamer
        remove_trait = hedonist
        remove_trait = duelist
        remove_trait = hunter
        remove_trait = strategist
        remove_trait = administrator
        remove_trait = architect
        remove_trait = gardener
        remove_trait = schemer
        remove_trait = impaler
        remove_trait = seducer
        remove_trait = seductress
        remove_trait = theologian
        remove_trait = intellectual

        remove_trait = misguided_warrior
        remove_trait = tough_soldier
        remove_trait = skilled_tactician

        add_trait = brilliant_strategist

        random_list = {
            25 = { add_trait = warship_captain }
            25 = { add_trait = marine_captain }
            25 = { add_trait = frigate_pilot }
            25 = { add_trait = army_captain }
        }

        random_list = {
            10 = { add_trait = orbital_combat_specialist }
            10 = { add_trait = short_range_specialist }
            10 = { add_trait = long_range_combat_specialist }
            5  = { add_trait = pursuit_specialist }
            10 = { add_trait = range_generalist }
        }

        random_list = {
            25 = { add_trait = jungle_terrain_leader }
            25 = { add_trait = rough_terrain_leader }
            25 = { add_trait = mountain_terrain_leader }
            25 = { add_trait = desert_terrain_leader }
        }

        random_list = {
            10 = {
                add_trait = strong
            }
            5 = {
                health = 1
            }
        }

        random_list = {
            10 = {
                add_trait = narrow_flank_leader
            }
            10 = {
                add_trait = defensive_leader
            }
            10 = {
                add_trait = experimenter
            }
            10 = {
                add_trait = flanker
            }
            10 = {
                add_trait = heavy_infantry_leader
            }
            10 = {
                add_trait = inspiring_leader
            }
            10 = {
                add_trait = organizer
            }
            10 = {
                add_trait = siege_leader
            }
            10 = {
                add_trait = trickster
            }
            10 = {
                add_trait = aggressive_leader
            }
        }

        random_list = { # Flavor Randomization
            20 = {
                remove_trait = warship_captain
                remove_trait = frigate_pilot
                add_trait = army_captain
                add_trait = giant
                add_trait = strong
                add_trait = hunter
                change_martial = 2
                give_nickname = nick_the_giant
            }
            20 = {
                modifier = {
                    factor = 0
                    NOT = {
                        has_dlc = "Reapers"
                    }
                }
                add_trait = disfigured
                add_trait = scarred
                add_trait = genius
                change_martial = 2
                change_intrigue = 12
                give_nickname = nick_of_a_thousand_faces
            }
            20 = {
                add_trait = cybernetic_leg
                add_trait = cybernetic_limb
                add_trait = cybernetic_skeleton
                add_trait = dni
                if = {
                    limit = { location = { TECH_CYBERNETICS = 4 } }
                    add_trait = full_cybernetic_conversion
                    add_trait = odin_mk_iii
                }
                else = { add_trait = odin_mk_i }
                give_nickname = nick_the_scarred
            }
            20 = {
                remove_trait = warship_captain
                remove_trait = marine_captain
                add_trait = frigate_pilot
                add_trait = agile
                add_trait = brave
                give_nickname = nick_the_comet
            }
            20 = {
                remove_trait = friendly
                remove_trait = craven
                remove_trait = carefree
                add_trait = cold
                add_trait = brave
                add_trait = disciplined
                add_trait = unyielding_leader
                give_nickname = nick_the_ironside
            }
            20 = {
                remove_trait = friendly
                remove_trait = disciplined
                add_trait = cold
                add_trait = carefree
                add_trait = aggressive_leader
                give_nickname = nick_the_destroyer
            }
            20 = {
                remove_trait = close_minded
                remove_trait = disciplined
                add_trait = open_minded
                add_trait = carefree
                add_trait = trickster
                add_trait = strategist
                martial = 2
                give_nickname = nick_the_fox
            }
            20 = {
                remove_trait = pragmatic
                remove_trait = craven
                remove_trait = neurotic
                add_trait = radical
                add_trait = brave
                add_trait = confident
                give_nickname = nick_the_hammer
            }
            20 = {
                remove_trait = frigate_pilot
                remove_trait = marine_captain
                add_trait = warship_captain
                add_age = 30
                remove_trait = cold
                remove_trait = carefree
                add_trait = friendly
                add_trait = disciplined
                martial = 4
                give_nickname = nick_the_old_man
            }
        }
        # Cybernetics
        if = {
            limit = { NOT = { religion_group = religious_group } }
            random_list = {
                100 = { }
                25 = { add_trait = cybernetic_limb }
                25 = {
                    if = {
                        limit = { has_dlc = "Reapers" }
                        add_trait = cybernetic_leg
                    }
                    else = { add_trait = cybernetic_limb }
                }
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
            }
            random = {
                chance = 20
                add_trait = dni
                add_trait = odin_mk_i
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 2 }
            }
            random = {
                chance = 20
                add_trait = dni
                remove_trait = odin_mk_i
                add_trait = odin_mk_ii
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 4 }
            }
            random = {
                chance = 20
                add_trait = dni
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                add_trait = odin_mk_iii
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 6 }
            }
            random = {
                chance = 20
                add_trait = dni
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                remove_trait = odin_mk_iii
                add_trait = odin_mk_iv
            }
        }
        if = {
            limit = {
                NOT = { trait = one_eyed }
                NOT = { religion_group = religious_group }
                location = { TECH_CYBERNETICS = 8 }
            }
            random = {
                chance = 20
                add_trait = dni
                remove_trait = odin_mk_i
                remove_trait = odin_mk_ii
                remove_trait = odin_mk_iii
                remove_trait = odin_mk_iv
                add_trait = odin_mk_v
            }
        }
        # Biological Traits for specific cultures
        if = {
            limit = { culture = heavy_worlder_ge }
            random = {
                chance = 60
                remove_trait = spacer_physiology
                add_trait = heavy_worlder
            }
        }
        if = {
            limit = { culture = cat_splice_ge }
            random = {
                chance = 60
                add_trait = cat_splice
            }
        }
        if = {
            limit = { culture = organic_wifi_ge }
            random = {
                chance = 60
                add_trait = organic_wifi
            }
        }
        if = {
            limit = { culture = bio_ge }
            random = {
                chance = 35
                remove_trait = organic_wifi
                remove_trait = cat_splice
                remove_trait = spacer_physiology
                add_trait = heavy_worlder
            }
        }
        if = {
            limit = { culture = bio_ge }
            random = {
                chance = 25
                remove_trait = organic_wifi
                remove_trait = heavy_worlder
                remove_trait = spacer_physiology
                add_trait = cat_splice
            }
        }
        if = {
            limit = { culture = bio_ge }
            random = {
                chance = 35
                remove_trait = cat_splice
                remove_trait = heavy_worlder
                remove_trait = spacer_physiology
                add_trait = organic_wifi
            }
        }
        if = {
            limit = { culture = bio_ge }
            random = {
                chance = 5
                remove_trait = organic_wifi
                remove_trait = heavy_worlder
                remove_trait = cat_splice
                add_trait = spacer_physiology
            }
        }
        if = {
            limit = { any_liege = { trait = spacer_physiology } }
            random = {
                chance = 10
                remove_trait = heavy_worlder
                add_trait = spacer_physiology
            }
        }
        if = {
            limit = { religion = astrist }
            random = {
                chance = 25
                remove_trait = heavy_worlder
                add_trait = spacer_physiology
            }
        }
        if = {
            limit = {
                religion = astrist
                top_liege = { trait = spacer_physiology }
                }
            random = {
                chance = 25
                remove_trait = heavy_worlder
                add_trait = spacer_physiology
            }
        }
        if = {
            limit = { location = { province_id = 202 } }
            random = {
                chance = 66
                add_trait = born_in_the_purple
            }
        }
        set_dynasty_flag = flag_valid_surname
        set_character_flag = invited_soldier
        save_event_target_as = invited_character
    }
}
